<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° PATHAK ULTIMATE ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; font-family: 'Poppins', sans-serif; color: white; padding-bottom: 50px; }
        .container { max-width: 600px; margin: auto; padding: 12px; }
        .header { background: #111; padding: 18px; border-bottom: 2px solid #0072ff; display: flex; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        
        .card { background: #111; padding: 16px; border-radius: 18px; margin-bottom: 15px; border: 1px solid #222; position: relative; }
        .upi-box { font-size: 15px; font-weight: 700; color: #00c6ff; background: #1a1a1a; padding: 10px; border-radius: 10px; border: 1px dashed #444; margin-bottom: 10px; cursor: pointer; text-align: center; }
        
        .amt-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .amt-txt { font-size: 30px; font-weight: 900; color: #fff; border-left: 5px solid #0072ff; padding-left: 10px; }
        
        .app-grid { display: flex; justify-content: space-around; gap: 8px; margin-bottom: 15px; background: #1a1a1a; padding: 12px; border-radius: 15px; }
        .app-item { text-align: center; cursor: pointer; flex: 1; }
        .app-item img { width: 42px; height: 42px; border-radius: 12px; border: 1.5px solid #333; margin-bottom: 4px; }
        .app-name { font-size: 9px; font-weight: 900; color: #888; text-transform: uppercase; }

        .btn-done { background: #fff; color: #000; border: none; padding: 14px; border-radius: 12px; font-weight: 900; width: 100%; cursor: pointer; font-size: 14px; box-shadow: 0 4px 15px rgba(255,255,255,0.1); }
        
        .loader { text-align: center; margin-top: 40px; color: #0072ff; font-weight: 900; }
        .hidden { display: none !important; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #00c6ff; color: #000; padding: 8px 20px; border-radius: 30px; font-weight: 900; font-size: 12px; display: none; z-index: 9999; box-shadow: 0 0 20px rgba(0,198,255,0.5); }
    </style>
</head>
<body>
    <div id="toast">‚úÖ UPI COPIED!</div>
    <div class="header">
        <div style="font-weight:900; font-size: 18px;">‚ö° PATHAK PRO</div>
        <div id="status-box" style="font-size:11px; color:#00ff00; font-weight:700;">‚óè REPORT 3 LIVE</div>
    </div>

    <div class="container">
        <div id="loader" class="loader">üöÄ BOOTING OLD LOGIC + PROXIES...</div>
        <div id="tasks-area"></div>
    </div>

    <script>
        // --- 1. CONFIG & OLD LOGIC START ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwfjyg_o0a_BUgiC0Iuoit3OTtzBHhkvVf8kg6XeI0DaCKVpBsbljCbpK-Tbb7uk-Dqvg/exec";
        const API_URL = "https://panel.visioncamp.in/api.php?auth-token=8df0570da65f3a1798408c942b82839a&report=3";
        
        let paidSet = new Set(), leads = [], offers = {};

        function copyAndNotify(text) {
            navigator.clipboard.writeText(text);
            const t = document.getElementById('toast');
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 1500);
        }

        function openPayApp(app, upi) {
            copyAndNotify(upi);
            const urls = {
                'paytm': "paytmmp://cash_wallet?feature=money_transfer",
                'phonepe': "phonepe://pay",
                'fampay': "fampay://",
                'gpay': "googlepay://"
            };
            setTimeout(() => { if(urls[app]) window.location.href = urls[app]; }, 400);
        }

        // --- 2. THE POWERFUL PROXY SYSTEM (Purana Logic) ---
        async function fetchWithRetry(url) {
            const proxies = [
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}&v=${Date.now()}`,
                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
            ];
            for (let p of proxies) {
                try {
                    const r = await fetch(p);
                    if (r.ok) {
                        const d = await r.json();
                        return d.data || d;
                    }
                } catch (e) { console.log("Proxy failed, trying next..."); }
            }
            return null;
        }

        async function init() {
            try {
                // Google Sheet Load
                const rSheet = await fetch(SCRIPT_URL);
                const dSheet = await rSheet.json();
                dSheet.forEach(k => paidSet.add(k));

                // Offers Load
                const rOffer = await fetch('offers.json');
                const dOffer = await rOffer.json();
                dOffer.forEach(o => {
                    offers[o.cid || o.id] = { t: o.title, u: parseInt(o.user_payout.replace(/\D/g,'')) || 6 };
                });

                await loadLeads();
            } catch(e) { console.error(e); setTimeout(init, 3000); }
        }

        async function loadLeads() {
            leads = await fetchWithRetry(API_URL);
            if(leads) render();
        }

        function render() {
            const area = document.getElementById('tasks-area');
            area.innerHTML = '';
            let count = 0;

            [...leads].reverse().forEach(l => {
                if(l.status.toLowerCase() !== 'approved') return;
                let sk = `${l.p1}_${l.offerid}_SELF`;
                if(paidSet.has(sk)) return;

                let o = offers[l.offerid] || { t: `Offer #${l.offerid}`, u: 6 };
                count++;

                area.innerHTML += `
                    <div class="card" id="card-${sk}">
                        <div class="upi-box" onclick="copyAndNotify('${l.p1}')">
                            ${l.p1} <span style="font-size:10px; color:#666; margin-left:10px;">TAP TO COPY</span>
                        </div>
                        
                        <div class="amt-row">
                            <div style="font-size:12px; color:#aaa; font-weight:700;">${o.t}</div>
                            <div class="amt-txt">‚Çπ${o.u}</div>
                        </div>
                        
                        <div class="app-grid">
                            <div class="app-item" onclick="openPayApp('fampay', '${l.p1}')">
                                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRz-M8v1XpW5qXoY8yWzB-L-U0fO8i_X3lCjw&s">
                                <div class="app-name">FamPay</div>
                            </div>
                            <div class="app-item" onclick="openPayApp('phonepe', '${l.p1}')">
                                <img src="https://logowik.com/content/uploads/images/phonepe-icon9223.logowik.com.webp">
                                <div class="app-name">PhonePe</div>
                            </div>
                            <div class="app-item" onclick="openPayApp('paytm', '${l.p1}')">
                                <img src="https://cdn.iconscout.com/icon/free/png-256/free-paytm-226448.png">
                                <div class="app-name">Paytm</div>
                            </div>
                            <div class="app-item" onclick="openPayApp('gpay', '${l.p1}')">
                                <img src="https://www.vectorlogo.zone/logos/google_pay/google_pay-icon.svg">
                                <div class="app-name">GPay</div>
                            </div>
                        </div>

                        <button class="btn-done" onclick="markPaid('${l.p1}', '${sk}')">‚úÖ MARK AS PAID</button>
                    </div>
                `;
            });
            document.getElementById('loader').classList.add('hidden');
            if(count === 0) document.getElementById('loader').innerHTML = "üì≠ NO PENDING TASKS!";
        }

        window.markPaid = function(upi, key) {
            if(confirm("Confirm Payment Done? Card will hide.")) {
                document.getElementById(`card-${key}`).style.opacity = '0.3';
                document.getElementById(`card-${key}`).style.pointerEvents = 'none';
                fetch(SCRIPT_URL + `?action=pay&key=${encodeURIComponent(key)}`, { mode: 'no-cors' });
                setTimeout(() => { document.getElementById(`card-${key}`).classList.add('hidden'); }, 500);
            }
        }

        init();
    </script>
</body>
</html>
